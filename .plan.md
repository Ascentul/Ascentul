# AI Prompt Editor - Full-Screen 3-Panel Layout

## Overview
Create a full-screen prompt editor experience that merges prompts and evals into an elegant side-by-side testing workflow.

## Current State Analysis
- Current dialog is limited width (`max-w-4xl`)
- Version history panel exists but is cramped
- Evals and prompts are separate tabs
- No side-by-side comparison capability

## Proposed Architecture

### Full-Screen Editor Mode
Replace the dialog with a full-screen overlay that takes over the viewport when editing prompts.

### 3-Panel Layout

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  Header: Tool Name | Save Draft | Run Eval | Get AI Suggestions | Close    │
├─────────────────┬─────────────────────────────────┬─────────────────────────┤
│                 │                                 │                         │
│  PANEL 1:       │  PANEL 2:                       │  PANEL 3:               │
│  Current/Old    │  New Version Editor             │  Eval Results &         │
│  Prompt         │                                 │  AI Suggestions         │
│                 │  - Monaco/CodeMirror editor     │                         │
│  - Read-only    │  - Syntax highlighting          │  - Score comparison     │
│  - Version info │  - AI suggestions inline        │  - Risk flags           │
│  - Quick stats  │  - Diff view toggle             │  - Improvement tips     │
│                 │                                 │  - Test case results    │
│                 │                                 │                         │
├─────────────────┴─────────────────────────────────┴─────────────────────────┤
│  Footer: Version: 1.0.0 → 1.1.0 | Status: Draft | Last eval: 0.85 (+0.12)  │
└─────────────────────────────────────────────────────────────────────────────┘
```

### Panel 1: Current Prompt (Left - ~25% width)
- Shows the current active/live prompt version
- Read-only display
- Version metadata (version string, status, risk level)
- Quick stats: model, temperature, max_tokens
- Collapsible to give more space to editor

### Panel 2: New Version Editor (Center - ~45% width)
- Main text editor for the new prompt
- Rich text/markdown support
- Line numbers
- AI suggestions appear as inline annotations or a suggestion bar
- Toggle for diff view (shows changes from current version)
- Form fields above: version bump type, kind, notes

### Panel 3: Eval & Suggestions (Right - ~30% width)
- **Score Dashboard**: Current vs New scores side by side
- **Risk Flags**: Visual indicators for detected issues
- **AI Suggestions**: GPT-generated improvement recommendations
- **Test Results**: Individual test case pass/fail with details
- **History**: Score progression as user iterates

## Implementation Steps

### Step 1: Create Full-Screen Editor Component
- New component: `src/components/admin/ai-quality/PromptEditor.tsx`
- Uses portal to render at document root
- Full viewport with escape to close
- Keyboard shortcuts (Ctrl+S save, Ctrl+E run eval)

### Step 2: Create Panel Components
- `PromptEditorCurrentPanel.tsx` - Left panel showing current version
- `PromptEditorEditPanel.tsx` - Center panel with editor
- `PromptEditorResultsPanel.tsx` - Right panel with evals/suggestions

### Step 3: Integrate Existing APIs
- Reuse `/api/admin/ai-quality/suggest-improvements` for AI suggestions
- Reuse `/api/admin/ai-quality/run-eval` for running evaluations
- Reuse Convex mutations for saving versions

### Step 4: Add Real-time Score Updates
- Run eval on demand (button click)
- Show score comparison: old vs new
- Visual progress indicator during eval

### Step 5: Update Main Page
- Add "Edit" button on prompt cards that opens full-screen editor
- Keep simple "New Version" dialog for quick edits
- Add keyboard shortcut to open editor

## File Structure

```
src/components/admin/ai-quality/
├── PromptEditor/
│   ├── index.tsx              # Main full-screen component
│   ├── CurrentPanel.tsx       # Left panel
│   ├── EditPanel.tsx          # Center panel
│   ├── ResultsPanel.tsx       # Right panel
│   ├── ScoreComparison.tsx    # Score visualization
│   └── SuggestionsList.tsx    # AI suggestions display
```

## UI/UX Details

### Header
- Tool display name with icon
- Version bump selector (patch/minor/major)
- Action buttons: Save Draft, Run Eval, Get Suggestions, Close

### Resizable Panels
- Users can drag panel dividers to resize
- Collapse buttons for panels 1 and 3
- Remember panel sizes in localStorage

### Editor Features
- Monaco Editor or simple textarea (start simple)
- Markdown preview toggle
- Character/word count
- Model/temperature/max_tokens settings

### Score Visualization
- Circular progress indicators for each dimension
- Color coding: green (>0.8), yellow (0.6-0.8), red (<0.6)
- Delta indicators: ↑ +0.15 or ↓ -0.05

### Keyboard Shortcuts
- `Esc` - Close editor
- `Ctrl/Cmd + S` - Save draft
- `Ctrl/Cmd + E` - Run evaluation
- `Ctrl/Cmd + I` - Get AI suggestions

## Migration Path
1. Build full-screen editor as new component
2. Add "Open Editor" button to existing prompt cards
3. Keep existing dialog for backward compatibility
4. Eventually deprecate old dialog

## Dependencies
- No new external dependencies needed
- Uses existing Tailwind, Radix UI, Convex
- Could add Monaco Editor later for rich editing (optional enhancement)
